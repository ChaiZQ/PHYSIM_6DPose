clc;

% Store results for pose estimation
rcnn_pose = {};
numpose = 1;

% data = {'0000','0002','0003','0006','0007',...
%         '0009','0011','0012','0017',...
%         '0019','0021','0022','0024','0028',...
%         '0029','0030','0032','0034','0035',...
%         '0037','0042','0043','0044','0045',...
%         '0046','0047','0049','0051','0053',...
%         '0054','0055','0056','0057','0060',...
%         '0061','0064','0065','0067','0068',...
%         '0071','0075','0076','0077','0078',...
%         '0080','0081','0090','0091','0092'};

data_warehouse = {'0002','0003','0004','0007','0008',...
        '0009','0013','0014','0015','0020',...
        '0021','0040','0041','0043','0044',...
        '0045','0047','0049','0050','0051',...
        '0054','0055','0059','0060','0061',...
        '0062','0063','0064','0067','0069',...
        '0070','0072','0073','0076','0077',...
        '0078','0079','0080','0081','0082'};

data_office = {'0000','0002','0003','0006','0007',...
        '0009','0011','0012','0017',...
        '0019','0021','0022','0024','0028',...
        '0029','0030','0032','0034','0035',...
        '0037','0042','0043','0044','0045',...
        '0046','0047','0049','0051','0053',...
        '0054','0055','0056','0057','0060',...
        '0061','0064','0065','0067','0068',...
        '0071','0075','0076','0077','0078',...
        '0080','0081','0090','0091','0092',...
        '0093','0094','0096','0097','0099',...
        '0101','0102','0103','0105','0106',...
        '0108','0109','0110','0112','0116',...
        '0117','0119','0120','0121','0122',...
        '0123','0124','0125','0126','0129',...
        '0130','0133','0135','0136',...
        '0142','0144','0145','0152','0153',...
        '0156','0160','0162','0164','0165',...
        '0166','0167','0168','0169','0170',...
        '0173','0174','0175','0176','0177',...
        '0178','0179','0180','0181','0183',...
        '0187','0188','0191','0192','0194',...
};

for scenenum=1:length(data_warehouse)
    currentScene = strcat('warehouse/practice/shelf/scene-',data_warehouse{1,scenenum});
    currentCalibration = 'warehouse/calibration';
    
    scenePath = fullfile('/home/pracsys/github/apc-vision-toolbox/data/benchmark',currentScene); % Directory holding the RGB-D data of the sample scene
    calibPath = fullfile('/home/pracsys/github/apc-vision-toolbox/data/benchmark',currentCalibration); % Directory holding camera pose calibration data for the sample scene

    [client,reqMsg] = rossvcclient('/pose_estimation');

    fprintf('calling pose estimation for scene %d \n', scenenum);
    reqMsg.SceneFiles = scenePath;
    reqMsg.CalibrationFiles = calibPath;
    response = call(client,reqMsg);
    
    for objects=1:size(response.Objects,1)
        quat = [response.Objects(objects,1).Pose.Orientation.W,...
                response.Objects(objects,1).Pose.Orientation.X,...
                response.Objects(objects,1).Pose.Orientation.Y,...
                response.Objects(objects,1).Pose.Orientation.Z];
        predObjPoseWorld = zeros(4,4);
        predObjPoseWorld(1:3,1:3) = quat2rot(quat);
        predObjPoseWorld(1,4) = response.Objects(objects,1).Pose.Position.X;
        predObjPoseWorld(2,4) = response.Objects(objects,1).Pose.Position.Y;
        predObjPoseWorld(3,4) = response.Objects(objects,1).Pose.Position.Z;

        poseStruct = struct('sceneName',currentScene,'objectName',response.Objects(objects,1).Label,'objectPose',predObjPoseWorld);
        rcnn_pose{numpose} = poseStruct;
        numpose = numpose + 1;
    end
end

for scenenum=1:length(data_office)
    currentScene = strcat('office/test/shelf/scene-',data_office{1,scenenum});
    currentCalibration = 'office/calibration';
    
    scenePath = fullfile('/home/pracsys/github/apc-vision-toolbox/data/benchmark',currentScene); % Directory holding the RGB-D data of the sample scene
    calibPath = fullfile('/home/pracsys/github/apc-vision-toolbox/data/benchmark',currentCalibration); % Directory holding camera pose calibration data for the sample scene

    [client,reqMsg] = rossvcclient('/pose_estimation');

    fprintf('calling pose estimation for scene %d \n', scenenum);
    reqMsg.SceneFiles = scenePath;
    reqMsg.CalibrationFiles = calibPath;
    response = call(client,reqMsg);
    
    for objects=1:size(response.Objects,1)
        quat = [response.Objects(objects,1).Pose.Orientation.W,...
                response.Objects(objects,1).Pose.Orientation.X,...
                response.Objects(objects,1).Pose.Orientation.Y,...
                response.Objects(objects,1).Pose.Orientation.Z];
        predObjPoseWorld = zeros(4,4);
        predObjPoseWorld(1:3,1:3) = quat2rot(quat);
        predObjPoseWorld(1,4) = response.Objects(objects,1).Pose.Position.X;
        predObjPoseWorld(2,4) = response.Objects(objects,1).Pose.Position.Y;
        predObjPoseWorld(3,4) = response.Objects(objects,1).Pose.Position.Z;

        poseStruct = struct('sceneName',currentScene,'objectName',response.Objects(objects,1).Label,'objectPose',predObjPoseWorld);
        rcnn_pose{numpose} = poseStruct;
        numpose = numpose + 1;
    end
end

rcnnpath = '/home/pracsys/github/apc-vision-toolbox/data/benchmark/rcnn-poses.mat';
save(rcnnpath, 'rcnn_pose');
